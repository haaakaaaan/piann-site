<!DOCTYPE html>
<html lang="tr">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>piann - auth test</title>
<body style="font-family:system-ui;max-width:560px;margin:40px auto">
  <h1>Google Giriş Hızlı Test</h1>
  <p>Bu sayfa sadece Firebase kimlik doğrulamasını test eder. Butona bas ve sonucu gör.</p>
  <div id="state" style="padding:10px 12px;border:1px solid #ddd;border-radius:8px;margin:12px 0;background:#fafafa">Durum: bekliyor…</div>
  <button id="btn" style="padding:10px 14px;border-radius:8px;border:1px solid #0A66C2;background:#0A66C2;color:#fff;font-weight:700;cursor:pointer">Google ile giriş</button>
  <button id="out" style="padding:10px 14px;border-radius:8px;border:1px solid #ddd;background:#fff;margin-left:8px;cursor:pointer;display:none">Çıkış</button>

  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>

  <script>
    // 🔐 Kendi config'in (piann-c58b8). Konsoldakiyle birebir olmalı:
    const firebaseConfig = {
      apiKey: "AIzaSyCB71Ffsvv3y5QArsgauAC91lhjFiE5K8Q",
      authDomain: "piann-c58b8.firebaseapp.com",
      projectId: "piann-c58b8",
      storageBucket: "piann-c58b8.appspot.com",
      messagingSenderId: "1086334896697",
      appId: "1:1086334896697:web:7770adc7f9438be4a49be8"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    auth.useDeviceLanguage();
    auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL);

    const $ = s=>document.querySelector(s);
    const state = $('#state'), btn=$('#btn'), out=$('#out');

    function showUser(u){
      if(!u){ state.textContent='Durum: oturum yok'; out.style.display='none'; return; }
      state.textContent = 'Giriş OK: ' + (u.displayName || u.email || u.uid);
      out.style.display='inline-block';
    }

    // Redirect dönüşünü yakala (olası popup engeli için)
    (async ()=>{
      try{
        await auth.getRedirectResult();
      }catch(e){
        state.textContent='Hata (redirect sonucu): '+(e?.code||e?.message||e);
      }
    })();

    auth.onAuthStateChanged(showUser);

    btn.onclick = async ()=>{
      state.textContent='Google açılıyor…';
      const provider = new firebase.auth.GoogleAuthProvider();
      try{
        await auth.signInWithPopup(provider); // önce popup
      }catch(err){
        state.textContent='Popup hata: '+(err?.code||err?.message||err)+' → redirect deniyorum…';
        try{
          await auth.signInWithRedirect(provider); // olmazsa redirect
        }catch(err2){
          state.textContent='Redirect hata: '+(err2?.code||err2?.message||err2);
        }
      }
    };

    out.onclick = ()=> auth.signOut();
  </script>
</body>
</html>
