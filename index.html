<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>piann — puan & sıralama</title>
<style>
  :root{
    --ink:#0f172a; --muted:#64748b; --line:#e6e9ef; --card:#fff;
    --accent:#0A66C2; --accent-600:#0857A6; --bg:#f7f8fb;
  }
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;color:var(--ink);background:var(--bg)}
  .wrap{max-width:1080px;margin:0 auto;padding:20px}
  /* topbar */
  .top{position:sticky;top:0;z-index:10;background:#fff;border-bottom:1px solid var(--line)}
  .topin{max-width:1080px;margin:0 auto;padding:10px 16px;display:flex;gap:12px;align-items:center}
  .brand{font-weight:800}
  .sp{flex:1}
  .btn{padding:10px 14px;border:1px solid var(--line);border-radius:10px;background:#fff;cursor:pointer;font-weight:600}
  .btn.primary{background:var(--accent);border-color:var(--accent);color:#fff}
  .btn.primary:hover{background:var(--accent-600)}
  .card{background:var(--card);border:1px solid var(--line);border-radius:14px;box-shadow:0 10px 24px rgba(15,23,42,.04)}
  .hd{padding:14px 16px;border-bottom:1px solid var(--line);font-weight:700}
  .bd{padding:16px}
  .hero h1{font-size:42px;line-height:1.15;margin:24px 0 8px}
  .muted{color:var(--muted)}
  section[hidden]{display:none !important}
  .warn{background:#fff8e1;border:1px solid #f6e3a1;color:#6b5b17;padding:10px 12px;border-radius:10px}
  .center{display:flex;justify-content:center}
  footer{margin:32px 0;text-align:center;color:var(--muted);font-size:12px}
</style>
</head>
<body>

<!-- NAV (oturumdan sonra görünür) -->
<div id="topbar" class="top" hidden>
  <div class="topin">
    <div class="brand">piann</div>
    <div class="sp"></div>
    <a class="btn" href="#/discover">Keşfet</a>
    <a class="btn" href="#/rank">Leaderboard</a>
    <a class="btn" href="#/profile">Profilim</a>
    <button id="btnSignOut" class="btn">Çıkış</button>
  </div>
</div>

<main class="wrap">
  <!-- LOGIN -->
  <section id="view-login">
    <div class="hero">
      <h1>Gerçek değerini keşfet; skorun senin imzan</h1>
      <p class="muted">piann, insanların birbirini puanladığı ve gerçek değerini gördüğü topluluk.</p>
    </div>

    <!-- in-app browser uyarısı -->
    <div id="iabWarn" class="warn" hidden>
      Tarayıcı yönlendirmesi bu uygulama içi pencere tarafından engellenebilir.
      Lütfen <b>“Tarayıcıda aç”</b> deyip sistem tarayıcısında deneyin.
    </div>

    <div class="card" style="max-width:520px;margin-top:18px">
      <div class="hd">Giriş yap</div>
      <div class="bd">
        <button id="btnGoogle" class="btn primary" style="width:100%">Google ile giriş yap</button>
        <div id="loginMsg" class="muted" style="margin-top:10px"></div>
      </div>
    </div>
  </section>

  <!-- DISCOVER -->
  <section id="view-discover" hidden>
    <div class="card">
      <div class="hd">Keşfet</div>
      <div class="bd">
        <p class="muted">Buraya 3’lü dikey profil kartlarını koyacağız. (Şablon)</p>
        <p>Giriş başarılı — router <code>#/discover</code>’a geçti.</p>
      </div>
    </div>
  </section>

  <!-- RANK -->
  <section id="view-rank" hidden>
    <div class="card">
      <div class="hd">Leaderboard</div>
      <div class="bd">
        <p class="muted">Sıralama tablosu burada (şablon).</p>
      </div>
    </div>
  </section>

  <!-- PROFILE -->
  <section id="view-profile" hidden>
    <div class="card">
      <div class="hd">Profil</div>
      <div class="bd">
        <div id="meBox">Oturum bilgisi yükleniyor…</div>
      </div>
    </div>
  </section>
</main>

<footer>© piann.com</footer>

<!-- Firebase compat -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>

<script>
/** 1) Firebase config — KENDİ PROJENİN AYNI CONFIG’İNİ YAPIŞTIR **/
const firebaseConfig = {
  apiKey: "AI...S8Q",
  authDomain: "piann-c58b8.firebaseapp.com",
  projectId: "piann-c58b8",
  storageBucket: "piann-c58b8.appspot.com",
  messagingSenderId: "1086334896697",
  appId: "1:1086334896697:web:7770adc7f9438be4a49be8"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();

/** 2) Yardımcılar **/
const $ = s => document.querySelector(s);
function isInAppBrowser(){
  const ua = navigator.userAgent || navigator.vendor || "";
  return /(FBAN|FBAV|Instagram|Line|Twitter|TikTok|Pinterest|Snapchat|LinkedIn)/i.test(ua);
}
function show(id){
  for (const el of document.querySelectorAll('section[id^="view-"]')) el.hidden = true;
  document.getElementById(id).hidden = false;
}
function showTopbar(showIt){ $('#topbar').hidden = !showIt; }

/** 3) Router **/
function router(){
  const h = location.hash || '#/';
  if (h.startsWith('#/discover')) show('view-discover');
  else if (h.startsWith('#/rank')) show('view-rank');
  else if (h.startsWith('#/profile')) show('view-profile');
  else show('view-login');
}
window.addEventListener('hashchange', router);

/** 4) Giriş — POPUP ONLY + fallback SESSION **/
async function signInWithGooglePopupOnly(){
  const msg = $('#loginMsg');
  msg.textContent = 'Google açılıyor…';
  const provider = new firebase.auth.GoogleAuthProvider();
  provider.setCustomParameters({ prompt: 'select_account' });
  try{
    await auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL);
  }catch{
    await auth.setPersistence(firebase.auth.Auth.Persistence.SESSION);
  }
  try{
    await auth.signInWithPopup(provider);
    msg.textContent = 'Giriş tamamlandı.';
  }catch(err){
    console.error(err);
    msg.textContent = 'Giriş hatası: ' + (err?.message || err);
  }
}

/** 5) onAuthStateChanged — oturum durumuna göre görünüm **/
auth.onAuthStateChanged(async (user)=>{
  if(user){
    showTopbar(true);
    // basit profil kutusu
    $('#meBox').innerHTML = `
      <div style="display:flex;gap:12px;align-items:center">
        <img src="${user.photoURL || 'https://i.pravatar.cc/100?u='+user.uid}"
             style="width:56px;height:56px;border-radius:50%;object-fit:cover">
        <div>
          <div style="font-weight:700">${user.displayName || user.email}</div>
          <div class="muted" style="font-size:14px">${user.email || ''}</div>
        </div>
      </div>`;
    // girişten sonra keşfete
    if (!location.hash || location.hash==='#/' || location.hash==='#') {
      location.hash = '#/discover';
    } else {
      router();
    }
  }else{
    showTopbar(false);
    location.hash = '#/';
    router();
  }
});

/** 6) UI bağla **/
$('#btnGoogle').onclick = signInWithGooglePopupOnly;
$('#btnSignOut').onclick = ()=> auth.signOut();
if(isInAppBrowser()){ $('#iabWarn').hidden = false; }

router(); // ilk yüklemede
</script>
</body>
</html>
